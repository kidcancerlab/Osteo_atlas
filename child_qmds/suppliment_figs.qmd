## Result 1
Suppliment 1A
```{r r1_suppliment_figs, eval = FALSE}

metadata_col <-
    list("CNV_status",
        "class",
      "scatomic_tumor_call",
      "scevan_tumor_call",
      "final_snv_call",
      "celltype_tumor_call")

cols <- list(
    tumor = "#D43F3AFF",
    Tumor = "#D43F3AFF",
    cancer_cells = "#D43F3AFF",
    aneuploid = "#D43F3AFF",
    normal_cells = "#EEA236FF",
    normal = "#EEA236FF",
    Host = "#EEA236FF",
    diploid = "#EEA236FF")


dimplot_list <- list()
for (group in c("patient_prim", "patient_mets",
                "mm_prim", "mm_mets",
                "dogs_prim", "dogs_mets")) {

    object <-
        qs::qread(str_c("output/seurat_objects/final_tumor_vs_stroma/",
                        group,
                        ".qs"))
    for (col in metadata_col) {
        if (col %in% colnames(object@meta.data)) {
            dimplot <-
                DimPlot(object,
                group.by = col, # Use the plot_labels for better aesthetics
                label.box = T,
                label = T,
                repel = T,
                cols = unlist(cols),
                label.size = 5,
                raster = F) +
            coord_fixed() +
            theme_void() +
            #scale_color_manual(values = cols) +
            NoLegend() +
            ggtitle(str_replace_all(col, "_", " ")) +
            theme(aspect.ratio=1,
                  plot.title = element_text(size = 15,
                                            hjust = 0.5))
        } else {
            dimplot <-
                ggplot(data = NULL) +
                aes(x = as.factor(1), y = as.factor(1)) +
                geom_text(aes(label = str_c(col, " not present for ", group)))
        }
        dimplot_list[[col]] <- dimplot
    }
    combined_plots <- 
        patchwork::wrap_plots(dimplot_list,
                            ncol = 2) +
            patchwork::plot_annotation(title = group) +
            theme(plot.title = element_text(size = 20))

    directory <-
        str_c("output/figures/Final_Annotations/results1/suppliment/", group)
    if (!dir.exists(directory)) {
        dir.create(directory, recursive = TRUE)
    }
    #save the combined plots
    ggsave(str_c(directory,
                 "/",
                 "combined_tumor_id_plots.pdf"),
           plot = combined_plots,
           width = 14,
           height = 21)
}

# make a featureplot of tumor
tumor_features <- 
    list("RUNX2",
        "SATB2",
        "COL1A1",
        "COL1A2")

featureplot_list <- list()

for (group in c("patient_prim", "patient_mets",
                "mm_prim", "mm_mets",
                "dogs_prim", "dogs_mets")) {
    object <-
        qs::qread(str_c("output/seurat_objects/final_tumor_vs_stroma/",
                        group,
                        ".qs"))
    for (feature in tumor_features) {
        if (object$organism[1] == "mouse") {
            feature <-
                nichenetr::convert_human_to_mouse_symbols(feature)
        }
        featureplot <-
            FeaturePlot(object,
                        features = feature,
                        order = T) +
            coord_fixed()  +
            theme_void() +
            ggtitle(feature) +
            theme(aspect.ratio=1,
                plot.title = element_text(size = 15,
                                        hjust = 0.5))
        
        # save the featureplot
        featureplot_list[[feature]] <- featureplot
    }
    dimplot1 <-
        dimplot_better(object,
                group_by = "Ann_Level0") +
        NoLegend() +
        ggtitle(str_replace_all(col, "_", " ")) +
        theme(aspect.ratio=1,
                plot.title = element_text(size = 15,
                                        hjust = 0.5))
    # make another col because the first is messy
    object$new_label_for_plot <-
        str_remove_all(object$SingleR_Ann3, "_.*")

    dimplot2 <-
        dimplot_better(object,
                group_by = "new_label_for_plot") +
        NoLegend() +
        ggtitle(str_replace_all(col, "_", " ")) +
        theme(aspect.ratio=1,
                plot.title = element_text(size = 15,
                                        hjust = 0.5))
        
    combined_plots <-
        patchwork::wrap_plots(featureplot_list[[1]],
                            featureplot_list[[2]],
                            featureplot_list[[3]],
                            featureplot_list[[4]],
                            dimplot1,
                            dimplot2,
                            ncol = 2) +
            patchwork::plot_annotation(title = group) +
            theme(plot.title = element_text(size = 20))

    directory <-
        str_c("output/figures/Final_Annotations/results1/suppliment/", group)
    if (!dir.exists(directory)) {
        dir.create(directory, recursive = TRUE)
    }
    #save the combined plots
    ggsave(str_c(directory,
                    "/",
                    "tumor_featureplots.pdf",
                    ".pdf"),
            plot = combined_plots,
            width = 14,
            height = 21)
}

```